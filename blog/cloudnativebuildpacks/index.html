
<!DOCTYPE html>
<html lang="en">

<head>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta http-equiv="X-UA-Compatible" content="ie=edge"/>

<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
            'https://www.googletagmanager.com/gtm.js?id=GTM-000000' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-000000');

</script>


<title>Home | Parameswaran V Vaidyanathan</title>
<link rel="shortcut icon" type="image/png" href="images/favicon.png">
<style>
     
    .rad-fade-in {
        will-change: opacity, transform;
        animation-name: rad-fade-in-fallback;
        animation-duration: 5s;
        animation-fill-mode: both;
    }

    @keyframes rad-fade-in-fallback {
        0% {
            opacity: 0;
        }

        75% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .fonts-loaded .rad-fade-in.rad-waiting {
        animation-name: none;
        opacity: 0;
    }

    .fonts-loaded .rad-fade-in.rad-animate {
        animation-name: rad-fade-in;
        animation-duration: 1.1s;
        animation-fill-mode: both;
    }

    @keyframes rad-fade-in {
        0% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

     
    .rad-fade-in-long {
        will-change: opacity, transform;
        animation-name: rad-fade-in-long-fallback;
        animation-duration: 8s;
        animation-fill-mode: both;
    }

    @keyframes rad-fade-in-long-fallback {
        0% {
            opacity: 0;
        }

        75% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .fonts-loaded .rad-fade-in-long.rad-waiting {
        animation-name: none;
        opacity: 0;
    }

    .fonts-loaded .rad-fade-in-long.rad-animate {
        animation-name: rad-fade-in-long;
        animation-duration: 2s;
        animation-fill-mode: both;
    }

    @keyframes rad-fade-in-long {
        0% {
            opacity: 0;
        }

        20% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

     
    .rad-fade-down {
        will-change: opacity, transform;
        animation-name: rad-fade-down-fallback;
        animation-duration: 5s;
        animation-fill-mode: both;
        transform: translateY(-30px);
    }

    @keyframes rad-fade-down-fallback {
        0% {
            opacity: 0;
            transform: translateY(-30px);
        }

        75% {
            opacity: 0;
            transform: translateY(-30px);
        }

        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fonts-loaded .rad-fade-down.rad-waiting {
        animation-name: none;
        opacity: 0;
        transform: translateY(-30px);
    }

    .fonts-loaded .rad-fade-down.rad-animate {
        animation-name: rad-fade-down;
        animation-duration: 1.1s;
    }

    @keyframes rad-fade-down {
        0% {
            opacity: 0;
            transform: translateY(-30px);
        }

        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

     
    .rad-scale-down {
        will-change: opacity, transform;
        animation-name: rad-scale-down-fallback;
        animation-duration: 5s;
        animation-fill-mode: both;
        transform-origin: 50% 0;
    }

    @keyframes rad-scale-down-fallback {
        0% {
            opacity: 0;
            transform: scaleY(0.95);
        }

        75% {
            opacity: 0;
            transform: scaleY(0.95);
        }

        100% {
            opacity: 1;
            transform: scaleY(1);
        }
    }

    .fonts-loaded .rad-scale-down.rad-waiting {
        animation-name: none;
        opacity: 0;
        transform: scaleY(0.95);
    }

    .fonts-loaded .rad-scale-down.rad-animate {
        animation-name: rad-scale-down;
        animation-duration: 1.1s;
        animation-fill-mode: both;
    }

    @keyframes rad-scale-down {
        0% {
            opacity: 0;
            transform: scaleY(0.95);
        }

        100% {
            opacity: 1;
            transform: scaleY(1);
        }
    }
</style>


<link rel="stylesheet" href="https://parameswaranvv.github.io/css/main.css"/>

<link rel="stylesheet" href="https://parameswaranvv.github.io/css/rad-icons.css"/>

<link rel="stylesheet" href="https://parameswaranvv.github.io/css/custom.css"/>


    


</head>

<body>

<header class="header fixed-top rad-animation-group" id="header">
    <div class="container rad-fade-in">
        <nav class="navbar navbar-expand-lg navbar-light p-0" style="color: #fff; background-color: #ee6e73; width: 100%; height: 56px; line-height: 56px;">
            <a class="navbar-brand" href="https://parameswaranvv.github.io">
                <span style="color: #212529;">Param</span>
                <span>V V</span>
            </a>
            <button
                    class="navbar-toggler"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarSupportedContent, #header"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
            >
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-lg-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://parameswaranvv.github.io">HOME</a>
                    </li>
                    
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="/#about"
                        >ABOUT</a
                        >
                    </li>
                    
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="/docs/resume.pdf"
                        >RESUME</a
                        >
                    </li>
                    
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="/blog"
                        >BLOG</a
                        >
                    </li>
                    
                </ul>
            </div>
        </nav>
    </div>
</header>

<section class="rad-showcase rad-showcase--index rad-animation-group rad-fade-down" style="padding-bottom: 10px; display: contents;">

    <div class="container">
        <div class="row" style="margin-right: 0; margin-left: 0; padding-top: 15%">
            <div id="wrapper" style="width: 100%;">
                <article class="post">
                    <header>
  <div class="title">
    
      <h2><a href="/blog/cloudnativebuildpacks/">Container Security &amp; Developer Productivity with Cloud Native Buildpacks</a></h2>
    
    
      <p>Container Security &amp; Developer Productivity</p>
    
  </div>
  <div class="meta">
    <time class="published" datetime="2020-04-30 13:00:40 -0500 -0500">
      April 30, 2020
    </time>
    <span class="author">Param V V</span>
    
  </div>
</header>

                    <section id="socnet-share">
                        





                    </section>
                    

                    <div class="content"> </br>
                        <aside>
                            <nav id="TableOfContents">
  <ul>
    <li><a href="#context--problems">Context & Problems</a>
      <ul>
        <li><a href="#developer-productivity">Developer Productivity</a></li>
        <li><a href="#container-security">Container Security</a></li>
      </ul>
    </li>
    <li><a href="#how-do-we-mitigate-these-problems">How do we mitigate these problems?</a></li>
    <li><a href="#buildpacks-primer">Buildpacks primer</a></li>
    <li><a href="#cloud-native-buildpacks-cnb">Cloud Native Buildpacks (CNB)</a></li>
  </ul>
</nav>
                        </aside>
                        <h2 id="context--problems">Context &amp; Problems</h2>
<p>The widespread adoption of Containerized workloads to be run on cloud platforms, has given rise to two interesting problems:</p>
<h3 id="developer-productivity">Developer Productivity</h3>
<div style="alignment: center"><img src="/images/cnb/developer-productivity.png" /></div></br>
<p>First, developers writing Dockerfiles (assuming Docker is the preferred container runtime), to deal with how their applications should be installed on the container OS image, along with what kind of dependencies are required. This takes away time from the developers when they could actually invest more time in developing and delivering business features.
Furthermore, the developers are burdened by:</p>
<ul>
<li>having to understand what kind of a container OS image should be used for a base image</li>
<li>how to organize the layers of the container image with their applications and dependencies</li>
<li>having to understand and code a condusive environment including Networking for the application to operate within the container and in the external ecosystem</li>
<li>ensure the container image that is created in the end conforms to full security policies as laid out by their organization</li>
<li>periodically maintain/apply security patches and remediate vulnerabilities as dictated by the enterprise</li>
<li>increase in counter-productive time for developers</li>
</ul>
<h3 id="container-security">Container Security</h3>
<div style="alignment: center"><img style="alignment: center" src="/images/cnb/container-security.png" /></div></br>
<p>Second, the operators need to ensure proper OS Patches are propagated across all the VMs and containers as per security and compliance standards. But,</p>
<ul>
<li>with a large scale ecosystem with more than 100s or 1000s of containers with different container OS images makes it difficult to roll out the patches for maybe a CVE that is found</li>
<li>operators need to work with developers across various teams in the enterprise to ensure the patches are rolled out in a timely manner</li>
</ul>
<h2 id="how-do-we-mitigate-these-problems">How do we mitigate these problems?</h2>
<p>If we can take away the mundane and non-productive work of defining Dockerfiles from developers, thats a first step. But, who will define the containers? The answer is Cloud Native Buildpacks(CNB).</p>
<p>Buildpacks have been around for a few years now, and prominent platforms like Heroku and CloudFoundry use Buildpacks at their core for packaging and running apps. Cloud Native Buildpacks is a step further towards ensuring that the gap between
operators and developers can be bridged. and make it easy for developers to containerize applications without writing Dockerfiles, and operators rolling out OS pactches to containers without needing to depend on developers.</p>
<h2 id="buildpacks-primer">Buildpacks primer</h2>
<ul>
<li>Buildpacks provide a framework and runtime support for the applications.</li>
<li>Buildpacks are able to detect what kind of application is it (Eg: Java/Spring, .NET, Node, Python, Ruby, etc)</li>
<li>Buildpacks are can package the application with the required dependencies and runtime as needed</li>
<li>Buildpacks can standardize the layouts for common application types like Java, Node, Python, etc.</li>
<li>Buildpacks can be customized to enterprise needs if standardized buildpacks are not sufficient to the current needs</li>
</ul>
<p>Now, there are a few things here that may not be relished by all. For example,</p>
<ul>
<li>The Buildpacks combine both the build and deploy phase. Esssentially, the buildpacks take your source code and turn them into a running application. This may not be ideal when we talk about testing changed before rolling out into higher environments.</li>
<li>Deploying the same application multiple times, will build the whole application again and again, including all the layers. This is not super performing.</li>
<li>Some platforms only use one base common image which brings in a lot of unnecessary dependencies which get bundled into the final application.</li>
</ul>
<p>Some may argue that it&rsquo;s better to use Dockerfile to have fine-grain control. But, with the growing needs of CI/CD automation, developers prefer to write multiple Dockerfiles to operate in each environment, and make use of Docker Compose to heavily customize the
operating enviroment for Integration tests, etc.</p>
<h2 id="cloud-native-buildpacks-cnb">Cloud Native Buildpacks (CNB)</h2>
<p>While Dockerfiles definitely give fine grain control to developers, the customization needs definitely takes away precious time from developers when they can actually focus more on implementing business features along with tests. Also,
more often container security takes a backseat when developers are heads down focused on getting the environment up and running asap. If the containers are indeed shipped to production, then it is just a ticking time-bomb for a security threat to go off.</p>
<p>Cloud Native Buildpacks solve this problem in an easy way. Let&rsquo;s discuss this with an example.</p>
<p>I have a Spring Boot application that is a webapp. It looks like this:</p>
<div style="alignment: center"><img src="/images/cnb/webapp.png" /></div></br>
<p>Now, traditionally, if I wanted to containerize this application, I as a developer would just add a Dockerfile that looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> openjdk:8-jdk-alpine</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> addgroup -S spring <span style="color:#f92672">&amp;&amp;</span> adduser -S spring -G spring<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> spring:spring</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> DEPENDENCY<span style="color:#f92672">=</span>build/dependency<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> <span style="color:#e6db74">${</span>DEPENDENCY<span style="color:#e6db74">}</span>/BOOT-INF/lib /app/lib<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> <span style="color:#e6db74">${</span>DEPENDENCY<span style="color:#e6db74">}</span>/META-INF /app/META-INF<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> <span style="color:#e6db74">${</span>DEPENDENCY<span style="color:#e6db74">}</span>/BOOT-INF/classes /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;-cp&#34;</span>,<span style="color:#e6db74">&#34;app:app/lib/*&#34;</span>,<span style="color:#e6db74">&#34;ExampleApplication&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>To correctly package this app, and extract it with the right layout in order to be able to package it into the image, I would also add a Shell Script that looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
mkdir -p build/dependency <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>cd build/dependency; jar -xf ../libs/*.jar<span style="color:#f92672">)</span>

docker build -t example-application:latest .
</code></pre></div><p>A few things to note here, I have taken utmost care in extracting my application and its dependencies to a suitable layout and copied them into the image.
I have also used an openjdk alpine image as my base. In an enterprise, this might typically need to be vetted out for security vulnerabilities and certify that
the image is hardened enough to use.</p>
<p>Now, the biggest problem is applying security patches to the container image or changing the base image as needed. Since the developer owns the Dockerfile, the operators need to
depend on the developer to get this done.</p>
<p>Cloud Native buildpacks simplify this by taking away the need to write the actual Dockerfile. Let&rsquo;s look at the steps to achieve this.</p>
<ul>
<li>Install the <code>pack</code> cli on your machine. For <code>macOS</code>, use <code>brew</code> to install as follows:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ brew tap buildpack/tap
$ brew install pack
</code></pre></div><ul>
<li>In the project directory, where your maven/gradle files exists, run the following:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pack set-default-builder cloudfoundry/cnb:bionic
$ pack build &lt;docker-registry-namespace&gt;/&lt;image-name&gt;
</code></pre></div><p>The first command actually sets the builder to use to build the app. The builder has all the necessary buildpacks to be able to auto-detect and choose the best
buildpack to be used. You can also run the following command to let pack suggest which builder to use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pack suggest-builders
Suggested builders:
	Cloud Foundry:     cloudfoundry/cnb:bionic         Ubuntu bionic base image with buildpacks <span style="color:#66d9ef">for</span> Java, NodeJS and Golang
	Cloud Foundry:     cloudfoundry/cnb:cflinuxfs3     cflinuxfs3 base image with buildpacks <span style="color:#66d9ef">for</span> Java, .NET, NodeJS, Golang, PHP, HTTPD and NGINX
	Cloud Foundry:     cloudfoundry/cnb:tiny           Tiny base image <span style="color:#f92672">(</span>bionic build image, distroless run image<span style="color:#f92672">)</span> with buildpacks <span style="color:#66d9ef">for</span> Golang
	Heroku:            heroku/buildpacks:18            heroku-18 base image with buildpacks <span style="color:#66d9ef">for</span> Ruby, Java, Node.js, Python, Golang, &amp; PHP

Tip: Learn more about a specific builder with:
	pack inspect-builder <span style="color:#f92672">[</span>builder image<span style="color:#f92672">]</span>

$ docker images
REPOSITORY                     TAG                 IMAGE ID            CREATED             SIZE
gcr.io/paketo-buildpacks/run   base-cnb            40845d52d6fb        <span style="color:#ae81ff">7</span> days ago          71.2MB
cloudfoundry/cnb               bionic              744709f7f5e0        <span style="color:#ae81ff">40</span> years ago        764MB
example-app                    latest              0346e71fe9fd        <span style="color:#ae81ff">40</span> years ago        260MB
</code></pre></div><p>You can see that two other images have also been downloaded, that were used to build the example-app image.</p>
<p>You can run this docker image as usual and/or push the image to your registry. Just use it like any other docker image.</p>
<p>When there is any application code change by a developer, CNB automatically reuses layers that are not affected, and only recreates the layers that are affected.
This is not possible when writing a custom Dockerfile. That&rsquo;s one of the biggest advantages because a developer need not worry about optimizing the image build process.
With CNB, the subsequent build should be real quick.</p>
<p>What happens if there is a CVE found in the base image <code>cloudfoundry/cnb:bionic</code>? How can an operate roll out the patch or updated base image without depending on a developer?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pack rebase &lt;docker-registry-namespace&gt;/&lt;image-name&gt; --publish
</code></pre></div><p>The above command would just check for a newer base run image, and download and swap that layer with the new one, from the original app image.</p>
<div style="alignment: center"><img src="/images/cnb/rebase.png" /></div></br>
<p>So, if this was integrated with a CI/CD pipeline, then it would save time greatly for developers, operators and make it very easy to handle container security in an enterprise setting.</p>
<p>We will discuss using KPack for automating the build and rollout process in the next blogpost. Also, I would discuss using Helm Charts for managing K8s deployments without having to write and manage numerous YAML files.</p>

                    </div>



                </article>
                

                <div class="pagination">
                    
                    <a href="/blog/open-policy-agent/" class="btn btn-primary" style="margin: 1em; width: 50%; color: #212529; background-color: rgba(255,255,255,0);"><div class="previous"><div>Previous: API Authorization using Open Policy Agent (OPA) as a Sidecar Container</div></div></a>
                    
                    
                </div>

            </div>
        </div>
    </div>
</section>

<footer class="footer">
  <div class="container">
    <div class="footer__left">
      <div class="footer__copy">
        © Parameswaran V Vaidyanathan. All rights reserved.
      </div>
    </div>
    <div class="footer__links">
      <ul class="navbar-nav ">
        <li class="nav-item">
          <a class="nav-link" href="https://parameswaranvv.github.io/blog/cloudnativebuildpacks/">Go to Top</a>
        </li>
        
      </ul>
    </div>








  </div>
</footer>


<script src='https://parameswaranvv.github.io/js/rad-animations.js'></script>
<script src='https://parameswaranvv.github.io/js/library/lozad.min.js'></script>
<script>
  window.addEventListener("load", function() {
    var observer = window.lozad(".lozad", {
      rootMargin: window.innerHeight / 2 + "px 0px",
      threshold: 0.01
    }); 
    observer.observe();
  });
</script>
<script src='https://parameswaranvv.github.io/js/library/jquery-3.3.1.slim.min.js'></script>
<script src='https://parameswaranvv.github.io/js/library/bootstrap.min.js'></script>
<script src='https://parameswaranvv.github.io/js/sticky-header.js'></script>
<script src='https://parameswaranvv.github.io/js/library/smooth-scroll.polyfills.min.js'></script>
<script src='https://parameswaranvv.github.io/js/library/fontfaceobserver.js'></script>
<script>
  (function(w) {
    
    if (w.document.documentElement.className.indexOf("fonts-loaded") > -1) {
      return;
    }
    var fontA = new w.FontFaceObserver("Inter", {
      weight: 300
    });
    var fontB = new w.FontFaceObserver("Inter", {
      weight: 400
    });
    var fontC = new w.FontFaceObserver("Inter", {
      weight: 500
    });
    var fontD = new w.FontFaceObserver("Inter", {
      weight: 600
    });
    var fontE = new w.FontFaceObserver("Inter", {
      weight: 700
    });
    var fontF = new w.FontFaceObserver("Inter", {
      weight: 900
    });
    w.Promise.all([fontA.load(), fontC.load(), fontF.load()]).then(function() {
      w.document.documentElement.className += " fonts-loaded";
    });
  })(this);
</script>
<script>
  const scroll = new SmoothScroll('a[href*="#"]');
    $('a.nav-link').on('click', () => {
      const navbar = $('.navbar-collapse');
      if (navbar && navbar.hasClass('show')) {
        $('.navbar-toggler').click();
      }
    })
</script>

<script type="text/javascript" src="js/materialize.min.js"></script>

</body>

</html>
